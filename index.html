<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>test</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
  <style>
    body { margin:0; font-family:Arial, sans-serif; background:#181a1b; color:#fff; }
    header { background:#202225; padding:12px 20px; display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid #2f3136; }
    header h1 { margin:0; font-size:20px; color:#4cc9f0; }
    .robux-box { display:flex; align-items:center; gap:8px; font-weight:bold; }
    .robux-box span { color:#00ff9d; }
    .btn-logout { background:#ff4d4d; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; color:#fff; }
    .layout { display:flex; height:calc(100vh - 56px); }
    .sidebar { width:220px; background:#202225; padding:20px 10px; display:flex; flex-direction:column; gap:15px; border-right:2px solid #2f3136; }
    .sidebar button { background:#2f3136; border:none; padding:12px; border-radius:8px; color:#fff; text-align:left; cursor:pointer; font-size:15px; transition:.2s; }
    .sidebar button:hover { background:#4cc9f0; color:#000; }
    .content { flex:1; padding:20px; overflow-y:auto; }
    .item { background:#2f3136; padding:12px; border-radius:10px; margin:10px; text-align:center; display:inline-block; width:160px; transition:.2s; }
    .item:hover { transform:scale(1.05); }
    .item img { width:100px; height:100px; object-fit:cover; border-radius:8px; }
    .btn { padding:6px 10px; border:none; border-radius:6px; margin:3px; cursor:pointer; font-weight:bold; font-size:14px; }
    .btn-buy { background:#4cc9f0; }
    .btn-delete { background:#ff4d4d; color:#fff; }
    #adminPanel { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#111; padding:20px; border:2px solid white; border-radius:10px; z-index:100; }
    .card { background:#202225; padding:25px; border-radius:12px; width:320px; margin:auto; margin-top:100px; text-align:center; }
    input { margin:6px 0; padding:10px; width:85%; border-radius:6px; border:none; background:#2f3136; color:#fff; }
    button { transition:.2s; }
    button:hover { opacity:0.9; }
  </style>
</head>
<body>

<header>
  <h1>üî• Roblox Revival</h1>
  <div style="display:flex; align-items:center; gap:15px;">
    <div class="robux-box" id="robuxBox" style="display:none;">üí∞ <span id="robuxDisplay">0</span> R$</div>
    <button class="btn-logout" id="logoutBtn" style="display:none;" onclick="logout()">Salir</button>
  </div>
</header>

<!-- üîπ Login / Register -->
<div id="authSection">
  <div class="card">
    <h2>Registrarse</h2>
    <input type="text" id="regUsername" placeholder="Usuario"><br>
    <input type="password" id="regPassword" placeholder="Contrase√±a"><br>
    <button class="btn" style="background:#4cc9f0;" onclick="register()">Registrar</button>
    <h2 style="margin-top:20px;">Iniciar Sesi√≥n</h2>
    <input type="text" id="logUsername" placeholder="Usuario"><br>
    <input type="password" id="logPassword" placeholder="Contrase√±a"><br>
    <button class="btn" style="background:#00ff9d;" onclick="login()">Entrar</button>
  </div>
</div>

<!-- üîπ Main -->
<div id="mainSection" style="display:none;">
  <div class="layout">
    <div class="sidebar">
      <button onclick="showSection('marketplace')">üõí Marketplace</button>
      <button onclick="showSection('profile')">üë§ Profile</button>
      <button onclick="showSection('friends')">üë• Friends</button>
    </div>
    <div class="content" id="contentArea">
      <h2>Bienvenido</h2>
      <p>Selecciona una secci√≥n</p>
    </div>
  </div>
</div>

<!-- üîπ Admin -->
<div id="adminPanel">
  <h3>Admin Panel</h3>
  <input id="itemName" placeholder="Nombre"><br>
  <input id="itemImg" placeholder="URL Imagen"><br>
  <input id="itemPrice" type="number" placeholder="Precio"><br>
  <input id="itemValue" type="number" placeholder="Valor"><br>
  <button class="btn" style="background:#4cc9f0;" onclick="addItem()">Agregar Item</button>
  <button class="btn" style="background:#ff4d4d;" onclick="closeAdmin()">Cerrar</button>
</div>

<script>
  // üî• Firebase Config
  const firebaseConfig = { 
    apiKey: "AIzaSyBwj_as6pb5Bg81F9Cl9VWTKkekMM9Exfk",
    authDomain: "pekora-forum.firebaseapp.com",
    projectId: "pekora-forum",
    storageBucket: "pekora-forum.firebasestorage.app",
    messagingSenderId: "161910967859",
    appId: "1:161910967859:web:6a28cecaae74b9b7e9dd46",
    measurementId: "G-BPBTW5KBRK"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  let currentUser = null;

  // üîπ Registrar usuario
  async function register(){
    const user = document.getElementById("regUsername").value.trim();
    const pass = document.getElementById("regPassword").value;
    if(!user || !pass) return alert("Completa los campos");

    const ref = db.collection("users").doc(user);
    const docSnap = await ref.get();
    if(docSnap.exists) return alert("‚ö†Ô∏è El usuario ya existe");

    await ref.set({ username:user, password:pass, robux:500 });
    currentUser = user;
    localStorage.setItem("loggedUser", user);
    await loadUserData();
  }

  // üîπ Login usuario
  async function login(){
    const user = document.getElementById("logUsername").value.trim();
    const pass = document.getElementById("logPassword").value;
    if(!user || !pass) return alert("Completa los campos");

    const ref = db.collection("users").doc(user);
    const docSnap = await ref.get();
    if(!docSnap.exists) return alert("‚ùå Usuario no encontrado");
    if(docSnap.data().password !== pass) return alert("‚ùå Contrase√±a incorrecta");

    currentUser = user;
    localStorage.setItem("loggedUser", user);
    await loadUserData();
  }

  // üîπ Logout
  function logout(){
    currentUser = null;
    localStorage.removeItem("loggedUser");
    document.getElementById("authSection").style.display="block";
    document.getElementById("mainSection").style.display="none";
    document.getElementById("robuxBox").style.display="none";
    document.getElementById("logoutBtn").style.display="none";
  }

  // üîπ Mantener sesi√≥n
  window.onload = async () => {
    const saved = localStorage.getItem("loggedUser");
    if(saved){ currentUser = saved; await loadUserData(); }
  }

  // üîπ Cargar datos usuario
  async function loadUserData(){
    const userDoc = await db.collection("users").doc(currentUser).get();
    if(!userDoc.exists) return;
    document.getElementById("robuxDisplay").innerText = userDoc.data().robux;
    document.getElementById("robuxBox").style.display="flex";
    document.getElementById("logoutBtn").style.display="inline-block";
    document.getElementById("authSection").style.display="none";
    document.getElementById("mainSection").style.display="block";
    loadMarketplace();
  }

  // üîπ Secciones
  function showSection(section){
    if(section==="marketplace") loadMarketplace();
    else if(section==="profile") loadProfile();
    else if(section==="friends") loadFriends();
  }

  // üîπ Marketplace
  function loadMarketplace(){
    const content=document.getElementById("contentArea");
    content.innerHTML="<h2>Marketplace</h2><div id='market'></div>";
    db.collection("items").onSnapshot(snap=>{
      let html="";
      snap.forEach(doc=>{
        const d=doc.data();
        html+=`
        <div class="item">
          <img src="${d.img}"><br>
          <b>${d.name}</b><br>
          üí∞ ${d.price} R$<br>
          Valor: ${d.value}<br>
          <button class="btn btn-buy" onclick="buyItem('${doc.id}',${d.price})">Comprar</button>
          ${currentUser==="admin" ? `<button class="btn btn-delete" onclick="deleteItem('${doc.id}')">Eliminar</button>` : ""}
        </div>`;
      });
      document.getElementById("market").innerHTML=html;
    });
  }

  // üîπ Comprar
  async function buyItem(itemId, price){
    const ref=db.collection("users").doc(currentUser);
    const doc=await ref.get();
    let robux=doc.data().robux;
    if(robux<price) return alert("No tienes suficiente Robux!");
    await ref.update({ robux: robux-price });
    const item=await db.collection("items").doc(itemId).get();
    await ref.collection("inventory").add({ ...item.data(), boughtAt:new Date() });
    loadUserData();
    alert("¬°Comprado!");
  }

  // üîπ Eliminar
  async function deleteItem(id){
    if(currentUser!=="admin") return alert("Solo admin puede borrar items!");
    await db.collection("items").doc(id).delete();
  }

  // üîπ Perfil
  async function loadProfile(){
    const content=document.getElementById("contentArea");
    const userDoc=await db.collection("users").doc(currentUser).get();
    content.innerHTML=`<h2>Perfil de ${currentUser}</h2><p>Robux: ${userDoc.data().robux}</p><h3>Inventario:</h3><div id='inv'></div>`;
    const inv=await db.collection("users").doc(currentUser).collection("inventory").get();
    let html="";
    for(let doc of inv.docs){
      const item=doc.data();
      html+=`
        <div class="item">
          <img src="${item.img}"><br>
          <b>${item.name}</b><br>
          üí∞ ${item.price} R$<br>
          Valor: ${item.value}
        </div>`;
    }
    document.getElementById("inv").innerHTML=html || "<p>Inventario vac√≠o</p>";
  }

  // üîπ Amigos
  async function loadFriends(){
    const content=document.getElementById("contentArea");
    content.innerHTML=`
      <h2>Amigos</h2>
      <input id="friendSearch" placeholder="Buscar usuario...">
      <button class="btn" style="background:#4cc9f0;" onclick="searchFriend()">Buscar</button>
      <div id="friendResult"></div>
      <h3>Solicitudes</h3><div id="requests"></div>
      <h3>Mis Amigos</h3><div id="friendsList"></div>
    `;
    loadRequests();
    loadFriendList();
  }

  // Buscar usuario
  async function searchFriend(){
    const name=document.getElementById("friendSearch").value.trim();
    if(!name) return;
    if(name===currentUser) return alert("No puedes agregarte a ti mismo");
    const ref=db.collection("users").doc(name);
    const doc=await ref.get();
    if(!doc.exists) return document.getElementById("friendResult").innerHTML="‚ùå Usuario no encontrado";
    document.getElementById("friendResult").innerHTML=`
      <p>üë§ ${name}</p>
      <button class="btn" style="background:#00ff9d;" onclick="sendRequest('${name}')">Enviar solicitud</button>
    `;
  }

  // Enviar solicitud
  async function sendRequest(toUser){
    await db.collection("users").doc(toUser).collection("requests").doc(currentUser).set({ from:currentUser });
    alert("‚úÖ Solicitud enviada a " + toUser);
  }

  // Cargar solicitudes
  function loadRequests(){
    const cont=document.getElementById("requests");
    db.collection("users").doc(currentUser).collection("requests").onSnapshot(snap=>{
      let html="";
      snap.forEach(doc=>{
        html+=`
          <p>${doc.id} quiere ser tu amigo 
            <button class="btn" style="background:#00ff9d;" onclick="acceptRequest('${doc.id}')">Aceptar</button>
            <button class="btn btn-delete" onclick="rejectRequest('${doc.id}')">Rechazar</button>
          </p>`;
      });
      cont.innerHTML=html || "No tienes solicitudes";
    });
  }

  // Aceptar solicitud
  async function acceptRequest(user){
    await db.collection("users").doc(currentUser).collection("friends").doc(user).set({ username:user });
    await db.collection("users").doc(user).collection("friends").doc(currentUser).set({ username:currentUser });
    await db.collection("users").doc(currentUser).collection("requests").doc(user).delete();
  }

  // Rechazar solicitud
  async function rejectRequest(user){
    await db.collection("users").doc(currentUser).collection("requests").doc(user).delete();
  }

  // Lista de amigos
  function loadFriendList(){
    const cont=document.getElementById("friendsList");
    db.collection("users").doc(currentUser).collection("friends").onSnapshot(snap=>{
      let html="";
      snap.forEach(doc=>{
        html+=`<p>üë• ${doc.id}</p>`;
      });
      cont.innerHTML=html || "No tienes amigos a√∫n";
    });
  }

  // üîπ Admin secreto
  document.addEventListener("keydown",e=>{
    if(e.key==="Insert"){
      const pass=prompt("Contrase√±a admin:");
      if(pass==="crackythebest") document.getElementById("adminPanel").style.display="block";
    }
  });
  function closeAdmin(){ document.getElementById("adminPanel").style.display="none"; }
  async function addItem(){
    const name=document.getElementById("itemName").value;
    const img=document.getElementById("itemImg").value;
    const price=parseInt(document.getElementById("itemPrice").value);
    const value=parseInt(document.getElementById("itemValue").value);
    if(!name||!img||!price||!value) return alert("Completa los campos");
    await db.collection("items").add({name,img,price,value});
    alert("Item agregado!");
  }
</script>

</body>
</html>
