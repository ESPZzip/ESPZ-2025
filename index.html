<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Roblox Revival Firebase</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#1e1e2f; color:white; margin:0; }
    header { background:#2c2c40; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; }
    .robux { display:flex; align-items:center; gap:8px; font-weight:bold; }
    .layout { display:flex; height:90vh; }
    .sidebar { width:200px; background:#2c2c40; padding:20px 10px; display:flex; flex-direction:column; gap:10px; }
    .sidebar button { background:#4cc9f0; border:none; padding:12px; border-radius:8px; cursor:pointer; text-align:left; }
    .sidebar button:hover { background:#3a9bdc; }
    .content { flex:1; padding:20px; overflow-y:auto; }
    .item { background:#3a3a55; padding:10px; border-radius:10px; margin:10px; text-align:center; display:inline-block; width:150px; }
    .item img { width:100px; height:100px; object-fit:cover; border-radius:8px; }
    .delete-btn { background:#ff4d4d; margin-top:8px; }
    #adminPanel { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#111; padding:20px; border:2px solid white; border-radius:10px; }
    .card { background:#2c2c40; padding:20px; border-radius:12px; width:300px; margin:auto; margin-top:100px; text-align:center; }
    input { margin:5px; padding:8px; width:80%; border-radius:6px; border:none; }
    button { margin-top:10px; padding:10px; border-radius:8px; border:none; cursor:pointer; }
  </style>
</head>
<body>

<header>
  <div> Roblox Revival</div>
  <div class="robux"> <span id="robuxDisplay">0</span> R$</div>
</header>

<div id="authSection">
  <div class="card">
    <h2>Registrarse</h2>
    <input type="text" id="regUsername" placeholder="Usuario"><br>
    <input type="password" id="regPassword" placeholder="Contrase帽a"><br>
    <button onclick="register()">Registrar</button>
    <h2>Iniciar Sesi贸n</h2>
    <input type="text" id="logUsername" placeholder="Usuario"><br>
    <input type="password" id="logPassword" placeholder="Contrase帽a"><br>
    <button onclick="login()">Entrar</button>
  </div>
</div>

<div id="mainSection" style="display:none;">
  <div class="layout">
    <div class="sidebar">
      <button onclick="showSection('marketplace')">Marketplace</button>
      <button onclick="showSection('profile')">Profile</button>
      <button onclick="showSection('friends')">Friends</button>
    </div>
    <div class="content" id="contentArea">
      <h2>Bienvenido</h2>
      <p>Selecciona una secci贸n</p>
    </div>
  </div>
</div>

<!-- Panel Admin -->
<div id="adminPanel">
  <h3>Admin Panel</h3>
  <input id="itemName" placeholder="Nombre"><br>
  <input id="itemImg" placeholder="URL Imagen"><br>
  <input id="itemPrice" type="number" placeholder="Precio"><br>
  <input id="itemValue" type="number" placeholder="Valor"><br>
  <button onclick="addItem()">Agregar Item</button>
  <button onclick="closeAdmin()">Cerrar</button>
</div>

<script>
  //  Tu config de Firebase
  const firebaseConfig = { 
    apiKey: "AIzaSyBwj_as6pb5Bg81F9Cl9VWTKkekMM9Exfk",
    authDomain: "pekora-forum.firebaseapp.com",
    projectId: "pekora-forum",
    storageBucket: "pekora-forum.firebasestorage.app",
    messagingSenderId: "161910967859",
    appId: "1:161910967859:web:6a28cecaae74b9b7e9dd46",
    measurementId: "G-BPBTW5KBRK"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  let currentUser = null;

  //  Registrar usuario
  async function register(){
    const user = document.getElementById("regUsername").value;
    const pass = document.getElementById("regPassword").value;
    if(!user || !pass) return alert("Completa los campos");
    const ref = db.collection("users").doc(user);
    const docSnap = await ref.get();
    if(docSnap.exists) return alert("Usuario ya existe!");
    await ref.set({ username:user, password:pass, robux:500 });
    alert("Registrado! Ahora inicia sesi贸n");
  }

  //  Login usuario
  async function login(){
    const user = document.getElementById("logUsername").value;
    const pass = document.getElementById("logPassword").value;
    const ref = db.collection("users").doc(user);
    const docSnap = await ref.get();
    if(!docSnap.exists) return alert("Usuario no encontrado");
    if(docSnap.data().password !== pass) return alert("Contrase帽a incorrecta");
    currentUser = user;
    localStorage.setItem("loggedUser", user);
    loadUserData();
  }

  //  Mantener sesi贸n
  window.onload = async () => {
    const saved = localStorage.getItem("loggedUser");
    if(saved){
      currentUser = saved;
      await loadUserData();
    }
  }

  //  Cargar datos del usuario
  async function loadUserData(){
    const userDoc = await db.collection("users").doc(currentUser).get();
    document.getElementById("robuxDisplay").innerText = userDoc.data().robux;
    document.getElementById("authSection").style.display="none";
    document.getElementById("mainSection").style.display="block";
  }

  //  Mostrar secciones
  function showSection(section){
    if(section==="marketplace") loadMarketplace();
    else if(section==="profile") loadProfile();
    else if(section==="friends") loadFriends();
  }

  //  Marketplace
  function loadMarketplace(){
    const content=document.getElementById("contentArea");
    content.innerHTML="<h2>Marketplace</h2><div id='market'></div>";
    db.collection("items").onSnapshot(snap=>{
      let html="";
      snap.forEach(doc=>{
        const d=doc.data();
        html+=`
        <div class="item">
          <img src="${d.img}"><br>
          <b>${d.name}</b><br>
           ${d.price} R$<br>
          Valor: ${d.value}<br>
          <button onclick="buyItem('${doc.id}',${d.price})">Comprar</button>
          <button class="delete-btn" onclick="deleteItem('${doc.id}')">Eliminar</button>
        </div>`;
      });
      document.getElementById("market").innerHTML=html;
    });
  }

  //  Comprar item
  async function buyItem(itemId, price){
    const ref=db.collection("users").doc(currentUser);
    const doc=await ref.get();
    let robux=doc.data().robux;
    if(robux<price) return alert("No tienes suficiente Robux!");
    await ref.update({ robux: robux-price });
    // Guardar en inventario
    await ref.collection("inventory").add({ itemId, boughtAt:new Date() });
    loadUserData();
    alert("隆Comprado!");
  }

  //  Eliminar item (admin)
  async function deleteItem(id){
    await db.collection("items").doc(id).delete();
  }

  //  Perfil
  async function loadProfile(){
    const content=document.getElementById("contentArea");
    const userDoc=await db.collection("users").doc(currentUser).get();
    content.innerHTML=`<h2>Perfil de ${currentUser}</h2><p>Robux: ${userDoc.data().robux}</p><h3>Inventario:</h3><div id='inv'></div>`;
    const inv=await db.collection("users").doc(currentUser).collection("inventory").get();
    let html="";
    for(let doc of inv.docs){
      html+=`<div>Item ID: ${doc.data().itemId}</div>`;
    }
    document.getElementById("inv").innerHTML=html;
  }

  //  Amigos (placeholder)
  function loadFriends(){
    document.getElementById("contentArea").innerHTML="<h2>Amigos (en construcci贸n)</h2>";
  }

  //  Admin Panel
  document.addEventListener("keydown",e=>{
    if(e.key==="Insert"){
      const pass=prompt("Contrase帽a admin:");
      if(pass==="crackythebest") document.getElementById("adminPanel").style.display="block";
    }
  });
  function closeAdmin(){ document.getElementById("adminPanel").style.display="none"; }

  async function addItem(){
    const name=document.getElementById("itemName").value;
    const img=document.getElementById("itemImg").value;
    const price=parseInt(document.getElementById("itemPrice").value);
    const value=parseInt(document.getElementById("itemValue").value);
    if(!name||!img||!price||!value) return alert("Completa los campos");
    await db.collection("items").add({name,img,price,value});
    alert("Item agregado!");
  }
</script>

</body>
</html>
