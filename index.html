<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Roblox Revival Firebase</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#1e1e2f; color:white; margin:0; }
    header { background:#2c2c40; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; }
    .robux { display:flex; align-items:center; gap:8px; font-weight:bold; }
    .layout { display:flex; height:90vh; }
    .sidebar { width:200px; background:#2c2c40; padding:20px 10px; display:flex; flex-direction:column; gap:10px; }
    .sidebar button { background:#4cc9f0; border:none; padding:12px; border-radius:8px; cursor:pointer; text-align:left; }
    .sidebar button:hover { background:#3a9bdc; }
    .content { flex:1; padding:20px; overflow-y:auto; }
    .item { background:#3a3a55; padding:10px; border-radius:10px; margin:10px; text-align:center; display:inline-block; width:150px; }
    .item img { width:100px; height:100px; object-fit:cover; border-radius:8px; }
    .delete-btn { background:#ff4d4d; margin-top:8px; }
    #adminPanel { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#111; padding:20px; border:2px solid white; border-radius:10px; }
    .card { background:#2c2c40; padding:20px; border-radius:12px; width:300px; margin:auto; margin-top:100px; text-align:center; }
    input { margin:5px; padding:8px; width:80%; border-radius:6px; border:none; }
    button { margin-top:10px; padding:10px; border-radius:8px; border:none; cursor:pointer; }
    #logoutBtn { background:#ff4d4d; padding:8px 12px; border-radius:8px; cursor:pointer; }
  </style>
</head>
<body>

<header>
  <div>🔥 Roblox Revival</div>
  <div style="display:flex; align-items:center; gap:15px;">
    <div class="robux" id="robuxBox" style="display:none;">💰 <span id="robuxDisplay">0</span> R$</div>
    <button id="logoutBtn" style="display:none;" onclick="logout()">Salir</button>
  </div>
</header>

<!-- 🔹 Sección de login/registro -->
<div id="authSection">
  <div class="card">
    <h2>Registrarse</h2>
    <input type="text" id="regUsername" placeholder="Usuario"><br>
    <input type="password" id="regPassword" placeholder="Contraseña"><br>
    <button onclick="register()">Registrar</button>
    <h2>Iniciar Sesión</h2>
    <input type="text" id="logUsername" placeholder="Usuario"><br>
    <input type="password" id="logPassword" placeholder="Contraseña"><br>
    <button onclick="login()">Entrar</button>
  </div>
</div>

<!-- 🔹 Sección principal -->
<div id="mainSection" style="display:none;">
  <div class="layout">
    <div class="sidebar">
      <button onclick="showSection('marketplace')">Marketplace</button>
      <button onclick="showSection('profile')">Profile</button>
      <button onclick="showSection('friends')">Friends</button>
    </div>
    <div class="content" id="contentArea">
      <h2>Bienvenido</h2>
      <p>Selecciona una sección</p>
    </div>
  </div>
</div>

<!-- 🔹 Panel Admin -->
<div id="adminPanel">
  <h3>Admin Panel</h3>
  <input id="itemName" placeholder="Nombre"><br>
  <input id="itemImg" placeholder="URL Imagen"><br>
  <input id="itemPrice" type="number" placeholder="Precio"><br>
  <input id="itemValue" type="number" placeholder="Valor"><br>
  <button onclick="addItem()">Agregar Item</button>
  <button onclick="closeAdmin()">Cerrar</button>
</div>

<script>
  // 🔥 Config Firebase
  const firebaseConfig = { 
    apiKey: "AIzaSyBwj_as6pb5Bg81F9Cl9VWTKkekMM9Exfk",
    authDomain: "pekora-forum.firebaseapp.com",
    projectId: "pekora-forum",
    storageBucket: "pekora-forum.firebasestorage.app",
    messagingSenderId: "161910967859",
    appId: "1:161910967859:web:6a28cecaae74b9b7e9dd46",
    measurementId: "G-BPBTW5KBRK"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  let currentUser = null;

  // 🔹 Registrar usuario
  async function register(){
    const user = document.getElementById("regUsername").value.trim();
    const pass = document.getElementById("regPassword").value;

    if(!user || !pass) return alert("Completa los campos");

    const ref = db.collection("users").doc(user);
    const docSnap = await ref.get();

    if(docSnap.exists){
      alert("⚠️ El usuario ya existe, elige otro nombre");
      return;
    }

    await ref.set({ username:user, password:pass, robux:500 });

    currentUser = user;
    localStorage.setItem("loggedUser", user);

    alert("✅ Registro exitoso, bienvenido " + user);
    await loadUserData();
  }

  // 🔹 Login usuario
  async function login(){
    const user = document.getElementById("logUsername").value.trim();
    const pass = document.getElementById("logPassword").value;

    if(!user || !pass) return alert("Completa los campos");

    const ref = db.collection("users").doc(user);
    const docSnap = await ref.get();

    if(!docSnap.exists){
      alert("❌ Usuario no encontrado");
      return;
    }

    if(docSnap.data().password !== pass){
      alert("❌ Contraseña incorrecta");
      return;
    }

    currentUser = user;
    localStorage.setItem("loggedUser", user);

    alert("✅ Bienvenido de nuevo " + user);
    await loadUserData();
  }

  // 🔹 Logout
  function logout(){
    currentUser = null;
    localStorage.removeItem("loggedUser");

    document.getElementById("authSection").style.display = "block";
    document.getElementById("mainSection").style.display = "none";
    document.getElementById("robuxBox").style.display = "none";
    document.getElementById("logoutBtn").style.display = "none";
  }

  // 🔹 Mantener sesión
  window.onload = async () => {
    const saved = localStorage.getItem("loggedUser");
    if(saved){
      currentUser = saved;
      await loadUserData();
    }
  }

  // 🔹 Cargar datos usuario
  async function loadUserData(){
    const userDoc = await db.collection("users").doc(currentUser).get();
    if(!userDoc.exists) return;

    document.getElementById("robuxDisplay").innerText = userDoc.data().robux;
    document.getElementById("robuxBox").style.display="flex";
    document.getElementById("logoutBtn").style.display="inline-block";
    document.getElementById("authSection").style.display="none";
    document.getElementById("mainSection").style.display="block";

    loadMarketplace();
  }

  // 🔹 Secciones
  function showSection(section){
    if(section==="marketplace") loadMarketplace();
    else if(section==="profile") loadProfile();
    else if(section==="friends") loadFriends();
  }

  // 🔹 Marketplace
  function loadMarketplace(){
    const content=document.getElementById("contentArea");
    content.innerHTML="<h2>Marketplace</h2><div id='market'></div>";
    db.collection("items").onSnapshot(snap=>{
      let html="";
      snap.forEach(doc=>{
        const d=doc.data();
        html+=`
        <div class="item">
          <img src="${d.img}"><br>
          <b>${d.name}</b><br>
          💰 ${d.price} R$<br>
          Valor: ${d.value}<br>
          <button onclick="buyItem('${doc.id}',${d.price})">Comprar</button>
          ${currentUser==="admin" ? `<button class="delete-btn" onclick="deleteItem('${doc.id}')">Eliminar</button>` : ""}
        </div>`;
      });
      document.getElementById("market").innerHTML=html;
    });
  }

  // 🔹 Comprar item
  async function buyItem(itemId, price){
    const ref=db.collection("users").doc(currentUser);
    const doc=await ref.get();
    let robux=doc.data().robux;
    if(robux<price) return alert("No tienes suficiente Robux!");
    await ref.update({ robux: robux-price });

    const item=await db.collection("items").doc(itemId).get();
    await ref.collection("inventory").add({ 
      itemId, 
      name:item.data().name, 
      img:item.data().img, 
      price:item.data().price, 
      value:item.data().value, 
      boughtAt:new Date() 
    });

    loadUserData();
    alert("¡Comprado!");
  }

  // 🔹 Eliminar item (solo admin)
  async function deleteItem(id){
    if(currentUser!=="admin") return alert("Solo el admin puede borrar items!");
    await db.collection("items").doc(id).delete();
  }

  // 🔹 Perfil
  async function loadProfile(){
    const content=document.getElementById("contentArea");
    const userDoc=await db.collection("users").doc(currentUser).get();
    content.innerHTML=`<h2>Perfil de ${currentUser}</h2><p>Robux: ${userDoc.data().robux}</p><h3>Inventario:</h3><div id='inv'></div>`;
    const inv=await db.collection("users").doc(currentUser).collection("inventory").get();
    let html="";
    for(let doc of inv.docs){
      const item=doc.data();
      html+=`
        <div class="item">
          <img src="${item.img}"><br>
          <b>${item.name}</b><br>
          💰 ${item.price} R$<br>
          Valor: ${item.value}
        </div>`;
    }
    document.getElementById("inv").innerHTML=html || "<p>Inventario vacío</p>";
  }

  // 🔹 Amigos (placeholder)
  function loadFriends(){
    document.getElementById("contentArea").innerHTML="<h2>Amigos (en construcción)</h2>";
  }

  // 🔹 Admin Panel secreto
  document.addEventListener("keydown",e=>{
    if(e.key==="Insert"){
      const pass=prompt("Contraseña admin:");
      if(pass==="crackythebest") document.getElementById("adminPanel").style.display="block";
    }
  });
  function closeAdmin(){ document.getElementById("adminPanel").style.display="none"; }

  async function addItem(){
    const name=document.getElementById("itemName").value;
    const img=document.getElementById("itemImg").value;
    const price=parseInt(document.getElementById("itemPrice").value);
    const value=parseInt(document.getElementById("itemValue").value);
    if(!name||!img||!price||!value) return alert("Completa los campos");
    await db.collection("items").add({name,img,price,value});
    alert("Item agregado!");
  }
</script>

</body>
</html>
